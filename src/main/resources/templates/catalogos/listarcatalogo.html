<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="layout/layout :: head('Lista de Catálogos')">

<div th:replace="layout/layout :: contenido(~{::body})">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="text-primary fw-bold mb-0">
            <i class="fa-solid fa-layer-group"></i> Gestión de Catálogos
        </h3>

        <a th:href="@{/catalogos/nuevo}" class="btn btn-success">
            <i class="fa-solid fa-plus"></i> Nuevo Catálogo
        </a>
    </div>

    <!-- Mensaje flash -->
    <div th:if="${mensaje}" 
         class="alert alert-success alert-dismissible fade show" 
         role="alert">
        <span th:text="${mensaje}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="table-responsive">
        <table id="tablaCatalogo" class="table table-bordered table-hover align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>Código</th>
                    <th>Tipo</th>
                    <th>Descripción</th>
                    <th>Estado</th>
                    <th width="160px">Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="c : ${catalogos}">
                    <td th:text="${c.codigoCat}" class="text-center"></td>
                    <td th:text="${c.tipoCat}"></td>
                    <td th:text="${c.descripcionCat}"></td>
                    <td class="text-center">
                        <span th:text="${c.estadoCat}"
                              th:classappend="${c.estadoCat == 'Activo'} ? 'badge bg-success px-3 py-2' 
                                               : 'badge bg-danger px-3 py-2'">
                        </span>
                    </td>
                    <td class="text-center">
                        <a th:href="@{/catalogos/editar/{id}(id=${c.codigoCat})}"
                           class="btn btn-warning btn-sm me-1">
                            <i class="fa-solid fa-pen"></i>
                        </a>

                        <button type="button"
                                class="btn btn-danger btn-sm"
                                th:onclick="'confirmarEliminacion(' + ${c.codigoCat} + ')'">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- DataTables -->
    <script>
        $(document).ready(function () {
            $('#tablaCatalogo').DataTable({
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.13.8/i18n/es-ES.json"
                }
            });
        });

        function confirmarEliminacion(id) {
            Swal.fire({
                title: '¿Eliminar registro?',
                text: "No podrás revertir esta acción",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Sí, eliminar'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '/catalogos/eliminar/' + id;
                }
            });
        }
    </script>

</div>
</html>